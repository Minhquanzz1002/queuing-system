"use strict";(self.webpackChunkmy_webpack_project=self.webpackChunkmy_webpack_project||[]).push([[229],{37431:(e,t,r)=>{r.d(t,{Cm:()=>p,Dc:()=>m,O0:()=>u,S0:()=>y});var n=r(91055),i=r(21851);function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const s=(0,n.rJ)(i.db,"roles"),l=(0,n.rJ)(i.db,"permissions"),u=async e=>{const t=e?[(0,n._M)("role","==",e)]:[],r=(0,n.P)(s,...t,(0,n.My)("name","asc"));return(await(0,n.GG)(r)).docs.map((e=>{const t=e.data();return{id:e.id,name:t.name,description:t.description,userCount:t.userCount}}))},m=async e=>{const t=(0,n.H9)(s,e),r=await(0,n.x7)(t);if(r.exists()){const e=r.data(),t=e.permissions,i=await Promise.all(t.map((async e=>{const t=await(0,n.x7)(e);return t.exists()?c({id:t.id},t.data()):null})));return c(c({id:r.id},e),{},{permissions:i})}return null},p=async e=>{try{return await(0,n.c4)(i.db,(async t=>{const r=(0,n.H9)(s),i=e.permissions.map((e=>(0,n.H9)(l,e)));return t.set(r,c(c({},e),{},{userCount:0,permissions:i})),r.id}))}catch(e){throw console.error("Error adding new role: ",e),e}},y=async(e,t)=>{const r=(0,n.H9)(s,e);try{await(0,n.c4)(i.db,(async e=>{if(!(await e.get(r)).exists())throw new Error("Role does not exist!");const i=c({},t);t.permissions&&(i.permissions=t.permissions.map((e=>(0,n.H9)(l,e)))),e.update(r,i)})),console.log("Role updated successfully")}catch(e){throw console.error("Error updating role: ",e),e}}},20831:(e,t,r)=>{r.d(t,{A:()=>c});var n=r(77810),i=r(26038),o=r(68190);const c=({style:e})=>n.createElement(o.A,{align:"center",gap:"small",className:"form-note",style:e},n.createElement(i.Q3,null),n.createElement("span",null,"Là trường thông tin bắt buộc"))},90481:(e,t,r)=>{r.r(t),r.d(t,{default:()=>h});var n=r(77810),i=r(87026),o=r(98617),c=r(68190),a=r(6194),s=r(77076),l=r(17192),u=r(28689),m=r(81342),p=r(90194),y=r(29200),f=r(69268),b=r(37431);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){v(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function v(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const h=()=>{const[e]=i.A.useForm(),t=(0,u.Zp)(),r=(0,y.G)(b.Cm);return n.createElement("div",{className:"device-detail"},n.createElement(c.A,{style:{padding:"2.4rem"},align:"center",justify:"space-between"},n.createElement(p.A,{items:[{title:"Cài đặt hệ thống"},{title:"Quản lý vai trò",href:"/admin/cai-dat/quan-ly-vai-tro"},{title:"Thêm vai trò"}]}),n.createElement(l.A,null)),n.createElement("div",{style:{paddingLeft:"2.4rem",paddingRight:"6.4rem"}},n.createElement(a.A.Title,{level:3,style:{marginBottom:"1.6rem"}},"Quản lý vai trò"),n.createElement(f.A,{form:e,initialValues:{},onFinish:async e=>{try{await r.execute(g(g({},e),{},{description:e.description||""})),o.Ay.success("Thêm vai trò thành công",5),t("/admin/cai-dat/quan-ly-vai-tro")}catch(e){console.error(e),o.Ay.error("Đã có lỗi xảy ra. Hãy thử lại sau",5)}}},n.createElement(c.A,{justify:"center",gap:"large"},n.createElement(m.N_,{to:"/admin/cai-dat/quan-ly-vai-tro"},n.createElement(s.Ay,{style:{backgroundColor:"#FFF2E7"},htmlType:"button",type:"primary",size:"large",ghost:!0},"Hủy bỏ")),n.createElement(s.Ay,{disabled:"loading"===r.status,htmlType:"submit",type:"primary",size:"large"},"Thêm")))))}},69268:(e,t,r)=>{r.d(t,{A:()=>S});var n=r(77810),i=r(87026),o=r(6194),c=r(64362),a=r(4504),s=r(14856),l=r(68190),u=r(79543),m=r(29200),p=r(91055),y=r(21851);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const d=(0,p.rJ)(y.db,"permissions"),g=async()=>{const e=(0,p.P)(d,(0,p.My)("name"));return(await(0,p.GG)(e)).docs.map((e=>function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({id:e.id},e.data())))};var v=r(74789);let h=function(e){return e.USER="USER",e.DEVICE="DEVICE",e.SERVICE="SERVICE",e.ROLE="ROLE",e}({});const O={[h.USER]:"người dùng",[h.DEVICE]:"thiết bị",[h.SERVICE]:"dịch vụ",[h.ROLE]:"vai trò"},E=({permissions:e,checkedList:t,onChange:r})=>{const[i,c]=(0,n.useState)({});return(0,n.useEffect)((()=>{const t=e.reduce(((e,t)=>(e[t.resource]||(e[t.resource]=[]),e[t.resource].push(t),e)),{});c(t)}),[e]),n.createElement("div",null,Object.entries(i).map((([e,c])=>{const a=c.map((e=>({label:e.description,value:e.id}))),s=t.filter((e=>c.some((t=>t.id===e)))),l=s.length>0&&s.length<c.length,u=s.length===c.length,m=O[e];return n.createElement("div",{style:{marginBottom:"2rem"},key:m},n.createElement(o.A.Title,{level:4},"Nhóm chức năng cho ",m),n.createElement(v.A,{indeterminate:l,onChange:n=>((e,n)=>{const o=i[e].map((e=>e.id));if(n.target.checked){const e=[...new Set([...t,...o])];r(e)}else{const e=t.filter((e=>!o.includes(e)));r(e)}})(e,n),checked:u,style:{marginBottom:"1.2rem"}},"Tất cả"),n.createElement(v.A.Group,{options:a,value:s,onChange:n=>((e,n)=>{const o=t.filter((t=>!i[e].some((e=>e.id===t))));r([...o,...n])})(e,n)}))})))};var j=r(20831);function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){A(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function A(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const S=({form:e,children:t,onFinish:r,initialValues:p})=>{const y=(0,m.G)(g),[f,b]=(0,n.useState)([]),[d,v]=(0,n.useState)([]);return(0,n.useEffect)((()=>{y.execute().then(b).catch((()=>b([])))}),[]),(0,n.useEffect)((()=>{const t=e.getFieldValue("permissions")||[];v(t)}),[e]),n.createElement(i.A,{form:e,onFinish:e=>{const t=P(P({},e),{},{permissions:Array.isArray(d)?d:[d].filter(Boolean)});r(t)},layout:"vertical",initialValues:p},n.createElement(u.A,null,n.createElement(o.A.Title,{level:4,style:{marginBottom:"1.6rem"}},"Thông tin vai trò"),n.createElement(c.A,{gutter:[24,0]},n.createElement(a.A,{span:12},n.createElement(i.A.Item,{label:"Tên vai trò:",name:"name",required:!0,rules:[{required:!0,message:"Vui lòng nhập tên vai trò"}]},n.createElement(s.A,{placeholder:"Nhập mã thiết bị",size:"large",autoFocus:!0})),n.createElement(i.A.Item,{label:"Mô tả",name:"description"},n.createElement(s.A.TextArea,{rows:4,placeholder:"Nhập mô tả",size:"large"})),n.createElement(j.A,null)),n.createElement(a.A,{span:12},n.createElement(i.A.Item,{label:"Phân quyền theo chức năng ",required:!0,name:"permissions",rules:[{validator:(e,t)=>t&&t.length>0?Promise.resolve():Promise.reject("Vui lòng chọn ít nhất một tùy chọn")}]},n.createElement(u.A,{style:{background:"#FFF2E7",minHeight:"unset",borderRadius:"0.8rem"}},n.createElement(l.A,{vertical:!0,gap:"middle"},n.createElement(E,{permissions:f,checkedList:d,onChange:t=>{e.setFieldsValue({permissions:t}),v(t),console.log(t)}}))))))),t)}}}]);