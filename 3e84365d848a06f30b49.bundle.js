"use strict";(self.webpackChunkmy_webpack_project=self.webpackChunkmy_webpack_project||[]).push([[119],{37431:(e,t,r)=>{r.d(t,{Cm:()=>p,Dc:()=>m,O0:()=>u,S0:()=>y});var n=r(91055),i=r(21851);function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const s=(0,n.rJ)(i.db,"roles"),l=(0,n.rJ)(i.db,"permissions"),u=async e=>{const t=e?[(0,n._M)("role","==",e)]:[],r=(0,n.P)(s,...t,(0,n.My)("name","asc"));return(await(0,n.GG)(r)).docs.map((e=>{const t=e.data();return{id:e.id,name:t.name,description:t.description,userCount:t.userCount}}))},m=async e=>{const t=(0,n.H9)(s,e),r=await(0,n.x7)(t);if(r.exists()){const e=r.data(),t=e.permissions,i=await Promise.all(t.map((async e=>{const t=await(0,n.x7)(e);return t.exists()?a({id:t.id},t.data()):null})));return a(a({id:r.id},e),{},{permissions:i})}return null},p=async e=>{try{return await(0,n.c4)(i.db,(async t=>{const r=(0,n.H9)(s),i=e.permissions.map((e=>(0,n.H9)(l,e)));return t.set(r,a(a({},e),{},{userCount:0,permissions:i})),r.id}))}catch(e){throw console.error("Error adding new role: ",e),e}},y=async(e,t)=>{const r=(0,n.H9)(s,e);try{await(0,n.c4)(i.db,(async e=>{if(!(await e.get(r)).exists())throw new Error("Role does not exist!");const i=a({},t);t.permissions&&(i.permissions=t.permissions.map((e=>(0,n.H9)(l,e)))),e.update(r,i)})),console.log("Role updated successfully")}catch(e){throw console.error("Error updating role: ",e),e}}},20831:(e,t,r)=>{r.d(t,{A:()=>a});var n=r(77810),i=r(26038),o=r(68190);const a=({style:e})=>n.createElement(o.A,{align:"center",gap:"small",className:"form-note",style:e},n.createElement(i.Q3,null),n.createElement("span",null,"Là trường thông tin bắt buộc"))},82952:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(77810),i=r(68190),o=r(37088),a=r(77076),c=r(81342);const s=()=>n.createElement(i.A,{align:"center",justify:"center",style:{minHeight:"100vh"}},n.createElement(o.Ay,{status:404,title:"404",subTitle:"Đường dẫn không tồn tại",extra:n.createElement(c.N_,{to:"/dashboard"},n.createElement(a.Ay,{type:"primary"},"Back dashboard"))}))},98359:(e,t,r)=>{r.r(t),r.d(t,{default:()=>O});var n=r(77810),i=r(87026),o=r(68190),a=r(23079),c=r(98617),s=r(6194),l=r(77076),u=r(17192),m=r(28689),p=r(81342),y=r(90194),f=r(29200),b=r(82952),d=r(37431),g=r(69268);function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){E(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function E(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const O=()=>{const[e]=i.A.useForm(),t=(0,m.Zp)(),{id:r}=(0,m.g)(),[h,E]=(0,n.useState)(null),O=(0,f.G)(d.Dc),j=(0,f.G)(d.S0);if((0,n.useEffect)((()=>{r&&O.execute(r).then(E).catch((()=>E(null)))}),[r]),"loading"===O.status)return n.createElement(o.A,{align:"center",justify:"center",className:"h-100vh"},n.createElement(a.A,{size:"large"}));if(!h)return n.createElement(b.A,null);const w=v(v({},h),{},{permissions:h.permissions.map((e=>e.id))});return n.createElement("div",{className:"device-detail"},n.createElement(o.A,{style:{padding:"2.4rem"},align:"center",justify:"space-between"},n.createElement(y.A,{items:[{title:"Cài đặt hệ thống"},{title:"Quản lý vai trò",href:"/admin/cai-dat/quan-ly-vai-tro"},{title:"Cập nhật vai trò"}]}),n.createElement(u.A,null)),n.createElement("div",{style:{paddingLeft:"2.4rem",paddingRight:"6.4rem"}},n.createElement(s.A.Title,{level:3,style:{marginBottom:"1.6rem"}},"Danh sách vai trò"),n.createElement(g.A,{form:e,initialValues:w,onFinish:async e=>{try{await j.execute(h.id,v(v({},e),{},{description:e.description||""})),c.Ay.success("Cập nhật vai trò thành công",5),t("/admin/cai-dat/quan-ly-vai-tro")}catch(e){console.error(e),c.Ay.error("Đã có lỗi xảy ra. Hãy thử lại sau",5)}}},n.createElement(o.A,{justify:"center",gap:"large"},n.createElement(p.N_,{to:"/admin/cai-dat/quan-ly-vai-tro"},n.createElement(l.Ay,{style:{backgroundColor:"#FFF2E7"},htmlType:"button",type:"primary",size:"large",ghost:!0},"Hủy bỏ")),n.createElement(l.Ay,{htmlType:"submit",type:"primary",size:"large"},"Cập nhật")))))}},69268:(e,t,r)=>{r.d(t,{A:()=>S});var n=r(77810),i=r(87026),o=r(6194),a=r(64362),c=r(4504),s=r(14856),l=r(68190),u=r(79543),m=r(29200),p=r(91055),y=r(21851);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const d=(0,p.rJ)(y.db,"permissions"),g=async()=>{const e=(0,p.P)(d,(0,p.My)("name"));return(await(0,p.GG)(e)).docs.map((e=>function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({id:e.id},e.data())))};var h=r(74789);let v=function(e){return e.USER="USER",e.DEVICE="DEVICE",e.SERVICE="SERVICE",e.ROLE="ROLE",e}({});const E={[v.USER]:"người dùng",[v.DEVICE]:"thiết bị",[v.SERVICE]:"dịch vụ",[v.ROLE]:"vai trò"},O=({permissions:e,checkedList:t,onChange:r})=>{const[i,a]=(0,n.useState)({});return(0,n.useEffect)((()=>{const t=e.reduce(((e,t)=>(e[t.resource]||(e[t.resource]=[]),e[t.resource].push(t),e)),{});a(t)}),[e]),n.createElement("div",null,Object.entries(i).map((([e,a])=>{const c=a.map((e=>({label:e.description,value:e.id}))),s=t.filter((e=>a.some((t=>t.id===e)))),l=s.length>0&&s.length<a.length,u=s.length===a.length,m=E[e];return n.createElement("div",{style:{marginBottom:"2rem"},key:m},n.createElement(o.A.Title,{level:4},"Nhóm chức năng cho ",m),n.createElement(h.A,{indeterminate:l,onChange:n=>((e,n)=>{const o=i[e].map((e=>e.id));if(n.target.checked){const e=[...new Set([...t,...o])];r(e)}else{const e=t.filter((e=>!o.includes(e)));r(e)}})(e,n),checked:u,style:{marginBottom:"1.2rem"}},"Tất cả"),n.createElement(h.A.Group,{options:c,value:s,onChange:n=>((e,n)=>{const o=t.filter((t=>!i[e].some((e=>e.id===t))));r([...o,...n])})(e,n)}))})))};var j=r(20831);function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){A(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function A(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const S=({form:e,children:t,onFinish:r,initialValues:p})=>{const y=(0,m.G)(g),[f,b]=(0,n.useState)([]),[d,h]=(0,n.useState)([]);return(0,n.useEffect)((()=>{y.execute().then(b).catch((()=>b([])))}),[]),(0,n.useEffect)((()=>{const t=e.getFieldValue("permissions")||[];h(t)}),[e]),n.createElement(i.A,{form:e,onFinish:e=>{const t=P(P({},e),{},{permissions:Array.isArray(d)?d:[d].filter(Boolean)});r(t)},layout:"vertical",initialValues:p},n.createElement(u.A,null,n.createElement(o.A.Title,{level:4,style:{marginBottom:"1.6rem"}},"Thông tin vai trò"),n.createElement(a.A,{gutter:[24,0]},n.createElement(c.A,{span:12},n.createElement(i.A.Item,{label:"Tên vai trò:",name:"name",required:!0,rules:[{required:!0,message:"Vui lòng nhập tên vai trò"}]},n.createElement(s.A,{placeholder:"Nhập mã thiết bị",size:"large",autoFocus:!0})),n.createElement(i.A.Item,{label:"Mô tả",name:"description"},n.createElement(s.A.TextArea,{rows:4,placeholder:"Nhập mô tả",size:"large"})),n.createElement(j.A,null)),n.createElement(c.A,{span:12},n.createElement(i.A.Item,{label:"Phân quyền theo chức năng ",required:!0,name:"permissions",rules:[{validator:(e,t)=>t&&t.length>0?Promise.resolve():Promise.reject("Vui lòng chọn ít nhất một tùy chọn")}]},n.createElement(u.A,{style:{background:"#FFF2E7",minHeight:"unset",borderRadius:"0.8rem"}},n.createElement(l.A,{vertical:!0,gap:"middle"},n.createElement(O,{permissions:f,checkedList:d,onChange:t=>{e.setFieldsValue({permissions:t}),h(t),console.log(t)}}))))))),t)}}}]);