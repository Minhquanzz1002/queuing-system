"use strict";(self.webpackChunkmy_webpack_project=self.webpackChunkmy_webpack_project||[]).push([[270],{37431:(e,t,r)=>{r.d(t,{Cm:()=>p,Dc:()=>m,O0:()=>u,S0:()=>d});var n=r(91055),a=r(21851);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const s=(0,n.rJ)(a.db,"roles"),c=(0,n.rJ)(a.db,"permissions"),u=async e=>{const t=e?[(0,n._M)("role","==",e)]:[],r=(0,n.P)(s,...t,(0,n.My)("name","asc"));return(await(0,n.GG)(r)).docs.map((e=>{const t=e.data();return{id:e.id,name:t.name,description:t.description,userCount:t.userCount}}))},m=async e=>{const t=(0,n.H9)(s,e),r=await(0,n.x7)(t);if(r.exists()){const e=r.data(),t=e.permissions,a=await Promise.all(t.map((async e=>{const t=await(0,n.x7)(e);return t.exists()?l({id:t.id},t.data()):null})));return l(l({id:r.id},e),{},{permissions:a})}return null},p=async e=>{try{return await(0,n.c4)(a.db,(async t=>{const r=(0,n.H9)(s),a=e.permissions.map((e=>(0,n.H9)(c,e)));return t.set(r,l(l({},e),{},{userCount:0,permissions:a})),r.id}))}catch(e){throw console.error("Error adding new role: ",e),e}},d=async(e,t)=>{const r=(0,n.H9)(s,e);try{await(0,n.c4)(a.db,(async e=>{if(!(await e.get(r)).exists())throw new Error("Role does not exist!");const a=l({},t);t.permissions&&(a.permissions=t.permissions.map((e=>(0,n.H9)(c,e)))),e.update(r,a)})),console.log("Role updated successfully")}catch(e){throw console.error("Error updating role: ",e),e}}},26664:(e,t,r)=>{r.d(t,{JE:()=>m,TK:()=>d,lo:()=>u,nu:()=>p});var n=r(91055),a=r(21851);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const s=(0,n.rJ)(a.db,"users"),c=(0,n.rJ)(a.db,"roles"),u=async e=>{const t=e?[(0,n._M)("role","==",(0,n.H9)(c,e))]:[],r=(0,n.P)(s,...t,(0,n.My)("name","asc")),a=await(0,n.GG)(r);return await Promise.all(a.docs.map((async e=>{const t=e.data(),r=t.role;let a=null;if(c){const e=await(0,n.x7)((0,n.H9)(c,r.id));e.exists()&&(a=l({id:e.id},e.data()))}return l(l({id:e.id},t),{},{role:a})})))},m=async e=>{const t=(0,n.P)(s,(0,n._M)("username","==",e),(0,n.AB)(1)),r=await(0,n.GG)(t);if(r.empty)return null;{const e=r.docs[0],t=e.data(),a=t.role;let i=null;if(a){const e=await(0,n.x7)((0,n.H9)(c,a.id));e.exists()&&(i=l({id:e.id},e.data()))}return l(l({id:e.id},t),{},{role:i})}},p=async e=>{try{const t=l(l({},e),{},{role:(0,n.H9)(c,e.role)});return(await(0,n.gS)(s,t)).id}catch(e){throw console.error("Error adding user: ",e),new Error("Unable to add a user")}},d=async(e,t)=>{try{const r=(0,n.H9)(a.db,"users",e);if(t.role){const e=(0,n.H9)(c,t.role);await(0,n.mZ)(r,l(l({},t),{},{role:e}))}else await(0,n.mZ)(r,t)}catch(e){throw console.error("Error updating user: ",e),new Error("Unable to update the user")}}},71785:(e,t,r)=>{r.d(t,{A:()=>c});var n=r(77810),a=r(62265),i=r(45958),l=r(84740);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o.apply(null,arguments)}const s=e=>{const[t,r]=(0,n.useState)(!1),s=(0,n.useMemo)((()=>t?n.createElement(a.A,{style:{color:"#FF7506"}}):n.createElement(i.A,{style:{color:"#FF7506"}})),[t]);return n.createElement(l.A,o({size:"large",suffixIcon:s},e,{onDropdownVisibleChange:e=>r(e)}))};s.Option=l.A.Option;const c=s},23523:(e,t,r)=>{r.d(t,{A4:()=>l,CP:()=>n,Fv:()=>i,zh:()=>a});const n=[{required:!0,message:"Vui lòng nhập số điện thoại"},{pattern:/^0([35789])[0-9]{8}$/,message:"Số điện thoại không hợp lệ"}],a=[{required:!0,message:"Vui lòng nhập họ tên"},()=>({validator:(e,t)=>!t||t.trim().length>3?Promise.resolve():Promise.reject(new Error("Họ tên không hợp lệ. Tối thiểu 3 ký tự"))})],i=[{required:!0,message:"Vui lòng nhập mật khẩu"},{min:8,message:"Mật khẩu phải có ít nhất 8 ký tự"},{pattern:/^\S*$/,message:"Mật khẩu không được chứa khoảng trắng"}],l=[{required:!0,message:"Vui lòng nhập mật khẩu"},({getFieldValue:e})=>({validator:(t,r)=>r&&e("password")!==r?Promise.reject(new Error("Mật khẩu không khớp")):Promise.resolve()})]},24024:(e,t,r)=>{r.r(t),r.d(t,{default:()=>y});var n=r(77810),a=r(87026),i=r(98617),l=r(68190),o=r(6194),s=r(77076),c=r(17192),u=r(28689),m=r(81342),p=r(90194),d=r(29200),h=r(54904),g=r(26664);const y=()=>{const[e]=a.A.useForm(),t=(0,u.Zp)(),r=(0,d.G)(g.nu);return n.createElement("div",{className:"device-detail"},n.createElement(l.A,{style:{padding:"2.4rem"},align:"center",justify:"space-between"},n.createElement(p.A,{items:[{title:"Cài đặt hệ thống"},{title:"Quản lý tài khoản",href:"/admin/cai-dat/quan-ly-tai-khoan"},{title:"Thêm tài khoản"}]}),n.createElement(c.A,null)),n.createElement("div",{style:{paddingLeft:"2.4rem",paddingRight:"6.4rem"}},n.createElement(o.A.Title,{level:3,style:{marginBottom:"1.6rem"}},"Quản lý tài khoản"),n.createElement(a.A,{form:e,initialValues:{status:"ACTIVE"},onFinish:async e=>{try{await r.execute({name:e.name,username:e.username,phone:e.phone,password:e.password,email:e.email,role:e.role,status:e.status}),i.Ay.success("Thêm tài khoản thành công",5),t("/admin/cai-dat/quan-ly-tai-khoan")}catch(e){i.Ay.error("Đã có lỗi xảy ra. Hãy thử lại sau!",5),console.error(e)}},layout:"vertical"},n.createElement(h.A,null),n.createElement(l.A,{justify:"center",gap:"large"},n.createElement(m.N_,{to:"/admin/cai-dat/quan-ly-tai-khoan"},n.createElement(s.Ay,{style:{backgroundColor:"#FFF2E7"},htmlType:"button",type:"primary",size:"large",ghost:!0},"Hủy bỏ")),n.createElement(s.Ay,{disabled:"loading"===r.status,htmlType:"submit",type:"primary",size:"large",tabIndex:9},"Thêm")))))}},54904:(e,t,r)=>{r.d(t,{A:()=>y});var n=r(77810),a=r(6194),i=r(64362),l=r(4504),o=r(87026),s=r(14856),c=r(68190),u=r(26038),m=r(79543),p=r(71785),d=r(29200),h=r(37431),g=r(23523);const y=()=>{const[e,t]=(0,n.useState)([]),r=(0,d.G)(h.O0);return(0,n.useEffect)((()=>{r.execute().then(t).catch((()=>t([])))}),[]),n.createElement(m.A,null,n.createElement(a.A.Title,{level:4,style:{marginBottom:"1.6rem"}},"Thông tin tài khoản"),n.createElement(i.A,{gutter:[24,0]},n.createElement(l.A,{span:12},n.createElement(o.A.Item,{label:"Họ tên:",name:"name",required:!0,rules:g.zh},n.createElement(s.A,{placeholder:"Nhập họ tên",size:"large",autoFocus:!0,tabIndex:1})),n.createElement(o.A.Item,{label:"Số điện thoại:",required:!0,name:"phone",rules:g.CP},n.createElement(s.A,{type:"tel",placeholder:"Nhập số điện thoại",size:"large",tabIndex:3})),n.createElement(o.A.Item,{label:"Email",required:!0,name:"email",rules:[{required:!0,message:"Vui lòng nhập email"},{type:"email",message:"Email không hợp lệ"}]},n.createElement(s.A,{placeholder:"Nhập email",size:"large",tabIndex:5})),n.createElement(o.A.Item,{label:"Vai trò",required:!0,name:"role",rules:[{required:!0,message:"Vui chọn vai trò"}]},n.createElement(p.A,{placeholder:"Chọn vai trò",tabIndex:7},e.map((e=>n.createElement(p.A.Option,{key:e.id},e.name)))))),n.createElement(l.A,{span:12},n.createElement(o.A.Item,{label:"Tên đăng nhập:",name:"username",required:!0,rules:[{required:!0,message:"Vui lòng nhập tên đăng nhập"},{min:8,message:"Tên đăng nhập phải có ít nhất 8 ký tự"},{pattern:/^[a-zA-Z0-9@#$&]+$/,message:"Tên đăng nhập chỉ chứa chữ, số hoặc các ký tự @#$&"}]},n.createElement(s.A,{placeholder:"Nhập tài khoản",size:"large",tabIndex:2})),n.createElement(o.A.Item,{label:"Mật khẩu:",required:!0,name:"password",rules:g.Fv},n.createElement(s.A.Password,{placeholder:"Nhập mật khẩu",size:"large",tabIndex:4})),n.createElement(o.A.Item,{label:"Nhập lại mật khẩu:",required:!0,name:"repeatPassword",rules:g.A4},n.createElement(s.A.Password,{placeholder:"Nhập lại mật khẩu",size:"large",tabIndex:6})),n.createElement(o.A.Item,{label:"Tình trạng",required:!0,name:"status",rules:[{required:!0,message:"Vui chọn tình trạng"}]},n.createElement(p.A,{placeholder:"Chọn loại thiết bị",tabIndex:8,options:[{label:"Hoạt động",value:"ACTIVE"},{label:"Ngưng hoạt động",value:"INACTIVE"}]})))),n.createElement(c.A,{align:"center",gap:"small",style:{fontSize:"1.4rem",lineHeight:"2.1rem",color:"#7E7D88"}},n.createElement(u.Q3,null),n.createElement("span",null,"Là trường thông tin bắt buộc")))}}}]);