"use strict";(self.webpackChunkmy_webpack_project=self.webpackChunkmy_webpack_project||[]).push([[105],{37431:(e,t,r)=>{r.d(t,{Cm:()=>p,Dc:()=>m,O0:()=>d,S0:()=>y});var n=r(91055),a=r(21851),o=r(65304);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const s=(0,n.rJ)(a.db,"roles"),u=(0,n.rJ)(a.db,"permissions"),d=async e=>{const t=e?[(0,n._M)("role","==",e)]:[],r=(0,n.P)(s,...t,(0,n.My)("name","asc"));return(await(0,n.GG)(r)).docs.map((e=>{const t=e.data();return{id:e.id,name:t.name,description:t.description,userCount:t.userCount}}))},m=async e=>{const t=(0,n.H9)(s,e),r=await(0,n.x7)(t);if(r.exists()){const e=r.data(),t=e.permissions,a=await Promise.all(t.map((async e=>{const t=await(0,n.x7)(e);return t.exists()?c({id:t.id},t.data()):null})));return c(c({id:r.id},e),{},{permissions:a})}return null},p=async e=>{try{return await(0,n.c4)(a.db,(async t=>{const r=(0,n.H9)(s),a=e.permissions.map((e=>(0,n.H9)(u,e)));return t.set(r,c(c({},e),{},{userCount:0,permissions:a})),await(0,o.T)({action:`Thêm role ${r.id}`,ipAddress:"192.168.1.1"}),r.id}))}catch(e){throw console.error("Error adding new role: ",e),e}},y=async(e,t)=>{const r=(0,n.H9)(s,e);try{await(0,n.c4)(a.db,(async e=>{if(!(await e.get(r)).exists())throw new Error("Role does not exist!");const a=c({},t);t.permissions&&(a.permissions=t.permissions.map((e=>(0,n.H9)(u,e)))),e.update(r,a)})),await(0,o.T)({action:`Update role ${e}`,ipAddress:"192.168.1.1"}),console.log("Role updated successfully")}catch(e){throw console.error("Error updating role: ",e),e}}},26664:(e,t,r)=>{r.d(t,{JE:()=>m,TK:()=>y,lo:()=>d,nu:()=>p});var n=r(91055),a=r(21851),o=r(65304);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const s=(0,n.rJ)(a.db,"users"),u=(0,n.rJ)(a.db,"roles"),d=async e=>{const t=e?[(0,n._M)("role","==",(0,n.H9)(u,e))]:[],r=(0,n.P)(s,...t,(0,n.My)("name","asc")),a=await(0,n.GG)(r);return await Promise.all(a.docs.map((async e=>{const t=e.data(),r=t.role;let a=null;if(u){const e=await(0,n.x7)((0,n.H9)(u,r.id));e.exists()&&(a=c({id:e.id},e.data()))}return c(c({id:e.id},t),{},{role:a})})))},m=async e=>{const t=(0,n.P)(s,(0,n._M)("username","==",e),(0,n.AB)(1)),r=await(0,n.GG)(t);if(r.empty)return null;{const e=r.docs[0],t=e.data(),a=t.role;let o=null;if(a){const e=await(0,n.x7)((0,n.H9)(u,a.id));e.exists()&&(o=c({id:e.id},e.data()))}return c(c({id:e.id},t),{},{role:o})}},p=async e=>{try{const t=c(c({},e),{},{role:(0,n.H9)(u,e.role)}),r=await(0,n.gS)(s,t);return await(0,o.T)({action:`Tạo tài khoản ${r.id}`,ipAddress:"192.168.1.1"}),r.id}catch(e){throw console.error("Error adding user: ",e),new Error("Unable to add a user")}},y=async(e,t)=>{try{const r=(0,n.H9)(a.db,"users",e);if(t.role){const e=(0,n.H9)(u,t.role);await(0,n.mZ)(r,c(c({},t),{},{role:e}))}else await(0,n.mZ)(r,t);await(0,o.T)({action:`Update tài khoản ${e}`,ipAddress:"192.168.1.1"})}catch(e){throw console.error("Error updating user: ",e),new Error("Unable to update the user")}}},71785:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(77810),a=r(62265),o=r(45958),i=r(84740);function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c.apply(null,arguments)}const l=e=>{const[t,r]=(0,n.useState)(!1),l=(0,n.useMemo)((()=>t?n.createElement(a.A,{style:{color:"#FF7506"}}):n.createElement(o.A,{style:{color:"#FF7506"}})),[t]);return n.createElement(i.A,c({size:"large",suffixIcon:l},e,{onDropdownVisibleChange:e=>r(e)}))};l.Option=i.A.Option;const s=l},31344:(e,t,r)=>{r.r(t),r.d(t,{default:()=>E});var n=r(77810),a=r(26038),o=r(17192),i=r(68190),c=r(6194),l=r(87026),s=r(22295),u=r(81342),d=r(57975),m=r(60763),p=r(90194),y=r(75265),f=r(29200),b=r(71785),h=r(26664),w=r(37431);const g=[{title:"Tên đăng nhập",dataIndex:"username",key:"user_username"},{title:"Họ tên",dataIndex:"name",key:"user_name"},{title:"Số điện thoại",dataIndex:"phone",key:"user_phone"},{title:"Email",dataIndex:"email",key:"user_email"},{title:"Vai trò",dataIndex:"role",key:"user_role",render:e=>e.name},{title:"Trạng thái hoạt động",dataIndex:"status",key:"user_status",render:e=>n.createElement(n.Fragment,null,"ACTIVE"===e?n.createElement(i.A,{gap:"small",className:"text-nowrap"},n.createElement(a.AB,{style:{color:"#35C75A"}})," Hoạt động"):n.createElement(i.A,{gap:"small",className:"text-nowrap"},n.createElement(a.AB,{style:{color:"#E73F3F"}}),"Ngưng hoạt động"))},{title:"",key:"user_update",render:(e,t)=>n.createElement(u.N_,{to:`/admin/cai-dat/quan-ly-tai-khoan/${t.username}/cap-nhat`},n.createElement(y.A,null,"Cập nhật"))}],E=()=>{const[e,t]=(0,n.useState)([]),[r,u]=(0,n.useState)([]),[y,E]=(0,n.useState)({role:"all"}),O=(0,f.G)(h.lo),v=(0,f.G)(w.O0);return(0,n.useEffect)((()=>{O.execute().then(t).catch((()=>t([]))),v.execute().then(u).catch((()=>u([])))}),[]),(0,n.useEffect)((()=>{const{role:e}=y,r="all"===e?void 0:e;O.execute(r).then(t).catch((()=>t([])))}),[y]),n.createElement("div",null,n.createElement(i.A,{style:{padding:"2.4rem"},align:"center",justify:"space-between"},n.createElement(p.A,{items:[{title:"Cài đặt hệ thống"},{title:"Quản lý tài khoản"}]}),n.createElement(o.A,null)),n.createElement("div",{style:{paddingLeft:"2.4rem",paddingRight:"10.4rem"}},n.createElement(c.A.Title,{level:3,style:{color:"#FF7506",marginBottom:"1.6rem"}},"Danh sách tài khoản"),n.createElement(l.A,{layout:"vertical",initialValues:y,onValuesChange:(e,t)=>{E(t)}},n.createElement(i.A,{justify:"space-between"},n.createElement(i.A,{vertical:!0,gap:4},n.createElement(l.A.Item,{label:"Tên vai trò",name:"role"},n.createElement(b.A,{style:{width:"30rem"}},n.createElement(b.A.Option,{key:"all"},"Tất cả"),r.map((e=>n.createElement(b.A.Option,{key:e.id},e.name)))))),n.createElement(i.A,{vertical:!0,gap:4},n.createElement(l.A.Item,{label:"Từ khóa"},n.createElement(m.A,{style:{width:"30rem"},id:"search",placeholder:"Nhập từ khóa"}))))),n.createElement(s.A,{bordered:!0,columns:g,dataSource:e,rowKey:e=>e.id})),n.createElement(d.A,null,n.createElement(d.A.Item,{icon:n.createElement(a.Jr,null),href:"/admin/cai-dat/quan-ly-tai-khoan/them-moi"},"Thêm",n.createElement("br",null)," tài khoản")))}}}]);